<html>
<h2>OpenTabs</h2>
<h3>#unhosted</h3>
Transactions:
<table border="1" id="thetable">
</table>
<script src="sample-calc.js"></script>
<script src="transactions.js"></script>
<script>
  transactions.sort(function(a, b) {
    return b.date-a.date;
  });
  var participants = ['michiel', 'javi', 'jan', 'hugo', 'martin', 'e.V.', 'nlnet', 'berlinerbank', 'pot'];
  var cursor=location.hash.substring(1);
  var balances = [];
  for(var i=0;i<participants.length;i++) {
    balances.push(0);
  }

  var str='<tr><td></td><td></td><td>'+participants.join('</td><td>')+'</td></tr>';
  var balanceline = false;
  for(var i=transactions.length-1;i>=0;i--) {
    console.log(i);
    //break;
    var deltas=[];
    for(var j=0;j<participants.length;j++) {
      if(participants[j]==transactions[i].from) {
        balances[j]+=transactions[i].amount;
        deltas.push(transactions[i].amount);
      } else if(participants[j]==transactions[i].to) {
        balances[j]-=transactions[i].amount;
        deltas.push(-transactions[i].amount);
      } else {
        deltas.push(0);
      }
    }

    if(transactions[i].date==cursor) {
      balanceline='<tr style="background-color:lightblue"><td>'+cursor.substring(0,4)+'.'+cursor.substring(4,6)+'.'+cursor.substring(6,8)
        +'</td><td>BALANCE:</td><td>'+balances.join('</td><td>')+'</td></tr>';
    } else if(balanceline) {//will happen once after cursor date has just been passed, so will go just above cursor date:
      str = balanceline+str;
      balanceline=false;
    }
    str = '<tr><td>'+transactions[i].date.substring(0,4)+'.'+transactions[i].date.substring(4,6)+'.'+transactions[i].date.substring(6,8)+'</td><td>'+transactions[i].comment
      +'</td><td>'+deltas.join('</td><td>')+'</td></tr>' + str;
  }
  document.getElementById('thetable').innerHTML=str;
</script>
